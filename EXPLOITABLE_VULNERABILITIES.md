# Exploitable Vulnerabilities - Quick Reference

**⚠️ CONFIDENTIAL - FOR SECURITY ASSESSMENT PURPOSES ONLY**

This document provides quick reference for the exploitable vulnerabilities found during penetration testing.

---

## Vulnerability Index

| ID | Severity | Exploitability | Impact | Location |
|----|----------|----------------|--------|----------|
| V01 | MEDIUM | LOW | MEDIUM | Integer Overflow |
| V02 | MEDIUM | LOW | LOW | GraphQL Injection |
| V03 | MEDIUM | LOW | MEDIUM | Path Traversal |
| V04 | LOW | LOW | LOW | Token in Logs |
| V05 | LOW | MEDIUM | LOW | Rate Limiting |
| V06 | LOW | LOW | LOW | Label Arrays |
| V07 | LOW | VERY LOW | VERY LOW | Timing Attack |

---

## V01: Integer Overflow in Input Parsing

### Severity: MEDIUM
**CWE-190:** Integer Overflow or Wraparound

### Vulnerable Code
```javascript
// src/index.js:25-29
const refactorThreshold = parseInt(core.getInput('refactor-threshold') || '4', 10)
const waitSeconds = parseInt(core.getInput('wait-seconds') || '300', 10)
const refactorCooldownDays = parseInt(core.getInput('refactor-cooldown-days') || '7', 10)
```

### Exploitation

**Attack Vector:** Malicious workflow configuration

```yaml
# .github/workflows/malicious.yml
- uses: mudman1986/auto-assign-copilot-action@main
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    refactor-threshold: '999999999999999999999'  # Overflow
    wait-seconds: '-1'                            # Bypass grace period
    refactor-cooldown-days: '2147483648'         # Max int overflow
```

**Impact:**
- Bypass wait times with negative values
- Cause unexpected behavior in GraphQL queries
- Potential memory issues with very large numbers

**Exploitability:** LOW (requires repository write access)

**Proof of Concept:**
```javascript
// See src/security.test.js - "Integer parsing vulnerabilities"
const largeNumber = '999999999999999999999'
const parsed = parseInt(largeNumber, 10)
console.log(Number.isSafeInteger(parsed)) // false - vulnerability demonstrated
```

### Remediation
```javascript
function validatePositiveInteger(value, defaultValue, min, max) {
  const parsed = parseInt(value || defaultValue, 10)
  
  if (isNaN(parsed)) {
    throw new Error(`Invalid integer: ${value}`)
  }
  
  if (parsed < min || parsed > max) {
    throw new Error(`Integer out of range: ${parsed}. Must be between ${min} and ${max}`)
  }
  
  if (!Number.isSafeInteger(parsed)) {
    throw new Error(`Integer not safe: ${parsed}`)
  }
  
  return parsed
}

// Usage
const refactorThreshold = validatePositiveInteger(
  core.getInput('refactor-threshold'), '4', 1, 100
)
const waitSeconds = validatePositiveInteger(
  core.getInput('wait-seconds'), '300', 0, 3600
)
const refactorCooldownDays = validatePositiveInteger(
  core.getInput('refactor-cooldown-days'), '7', 0, 365
)
```

---

## V02: GraphQL Query Parameter Injection

### Severity: MEDIUM
**CWE-943:** Improper Neutralization of Special Elements in Data Query Logic

### Vulnerable Code
```javascript
// src/workflow.js:551-581
const issues = await github.graphql(
  `
    query($owner: String!, $repo: String!, $label: String!) {
      repository(owner: $owner, name: $repo) {
        issues(first: 50, states: OPEN, labels: [$label], ...) {
  `,
  {
    ...repoVars,
    label  // User-controlled input
  }
)
```

### Exploitation

**Attack Vector:** Malicious label name in workflow

```yaml
- uses: mudman1986/auto-assign-copilot-action@main
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    label-override: 'bug", "secret-label'  # Injection attempt
```

**Attack Patterns:**
```
bug", "private-label          # Try to access multiple labels
bug\n{repository(owner:"x"    # Try to break query
bug} mutation {deleteRepo     # Try to inject mutation
```

**Impact:**
- Limited - GitHub GraphQL API validates inputs
- Potential to query unintended labels
- Query errors or unexpected behavior

**Exploitability:** LOW (GitHub API provides protection)

**Proof of Concept:**
```javascript
// See src/security.test.js - "GraphQL Injection"
const injectionAttempts = [
  'bug", variables: {repo: "other-repo"}',
  'bug\n{repository(owner:"attacker"',
  'bug} mutation {deleteRepository'
]
// These should be rejected before reaching GraphQL
```

### Remediation
```javascript
function validateLabelName(label) {
  if (!label || typeof label !== 'string') {
    return null
  }
  
  const trimmed = label.trim()
  
  // GitHub label constraints
  if (trimmed.length === 0 || trimmed.length > 50) {
    throw new Error(`Label length invalid: ${trimmed.length}`)
  }
  
  // Only allow safe characters (GitHub allows: alphanumeric, dash, underscore, space)
  if (!/^[a-zA-Z0-9\-_ ]+$/.test(trimmed)) {
    throw new Error(`Label contains invalid characters: ${trimmed}`)
  }
  
  return trimmed
}

// Usage
const labelOverride = validateLabelName(core.getInput('label-override')) || null
```

---

## V03: Enhanced Path Traversal Protection Needed

### Severity: MEDIUM
**CWE-22:** Path Traversal

### Vulnerable Code
```javascript
// src/helpers.js:206-230
const absolutePath = path.resolve(workspaceRoot, templatePath)
const relativePath = path.relative(workspaceRoot, absolutePath)

if (relativePath.startsWith('..') || path.isAbsolute(relativePath)) {
  // ... reject
}

// No file extension validation
// No file size limits
// UNC paths might not be properly handled
```

### Exploitation

**Attack Vector 1:** Windows UNC Path
```yaml
- uses: mudman1986/auto-assign-copilot-action@main
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    refactor-issue-template: '\\\\attacker-server\\share\\malicious.md'
```

**Attack Vector 2:** Executable File Extension
```yaml
refactor-issue-template: '.github/template.sh'  # Could execute if processed
```

**Attack Vector 3:** Oversized File
```yaml
refactor-issue-template: 'huge-file.md'  # 100MB template -> memory exhaustion
```

**Impact:**
- Information disclosure (read arbitrary files)
- Memory exhaustion (large files)
- Limited to read operations (no write)

**Exploitability:** LOW (requires Windows runner + specific conditions)

**Proof of Concept:**
```javascript
// See src/security.test.js - "Path Traversal"

// Test 1: UNC paths
helpers.readRefactorIssueTemplate('\\\\attacker-server\\share\\file.md')
// Current: Might not be properly rejected

// Test 2: Large files
fs.writeFileSync('large.md', 'A'.repeat(10 * 1024 * 1024))
helpers.readRefactorIssueTemplate('large.md')
// Current: No size limit, entire file loaded into memory

// Test 3: Executable extensions
helpers.readRefactorIssueTemplate('template.sh')
// Current: Any extension allowed
```

### Remediation
```javascript
function readRefactorIssueTemplate(templatePath) {
  const defaultContent = '...' // existing default
  
  if (!templatePath?.trim()) {
    return defaultContent
  }

  try {
    const workspaceRoot = process.env.GITHUB_WORKSPACE || process.cwd()
    
    // ENHANCED: Reject UNC paths and absolute paths immediately
    if (path.isAbsolute(templatePath) || templatePath.startsWith('\\\\')) {
      console.log(`Template path ${templatePath} is not a relative path`)
      return defaultContent
    }
    
    const absolutePath = path.resolve(workspaceRoot, templatePath)
    const relativePath = path.relative(workspaceRoot, absolutePath)

    // Check for path traversal
    if (relativePath.startsWith('..') || path.isAbsolute(relativePath)) {
      console.log(`Template path ${templatePath} is outside workspace`)
      return defaultContent
    }
    
    // ENHANCED: Validate file extension
    const allowedExtensions = ['.md', '.txt']
    const ext = path.extname(absolutePath).toLowerCase()
    if (!allowedExtensions.includes(ext)) {
      console.log(`Template file extension ${ext} not allowed`)
      return defaultContent
    }

    if (!fs.existsSync(absolutePath)) {
      console.log(`Template file not found at ${absolutePath}`)
      return defaultContent
    }

    // ENHANCED: Check file size (limit to 100KB)
    const stats = fs.statSync(absolutePath)
    const MAX_SIZE = 100 * 1024
    if (stats.size > MAX_SIZE) {
      console.log(`Template file too large (${stats.size} bytes)`)
      return defaultContent
    }

    const content = fs.readFileSync(absolutePath, 'utf8')
    console.log(`Successfully loaded template from ${absolutePath}`)
    return content
  } catch (error) {
    console.log(`Error reading template file: ${error.message}`)
    return defaultContent
  }
}
```

---

## V04-V07: Lower Severity Issues

### V04: Token Exposure in Logs (LOW)
- **Risk:** Verbose logging could expose sensitive data
- **Mitigation:** Token not directly logged, but review log content
- **Test:** `security.test.js` - "Information Disclosure"

### V05: Missing Rate Limiting (LOW)
- **Risk:** Multiple API calls could hit rate limits
- **Mitigation:** Concurrency controls already in workflow
- **Enhancement:** Add retry with exponential backoff

### V06: Insufficient Label Array Validation (LOW)
- **Risk:** Excessive skip-labels could cause performance issues
- **Mitigation:** Add maximum array size (50 labels)
- **Test:** `security.test.js` - "Denial of Service"

### V07: Timing Attack (LOW)
- **Risk:** Timing differences could leak information
- **Impact:** VERY LOW - not practical for GitHub Actions
- **Test:** `security.test.js` - "Timing Attacks"

---

## Exploitation Requirements

### Prerequisites for Exploitation

To exploit ANY of these vulnerabilities, an attacker needs:

1. **Repository Write Access**
   - Ability to modify `.github/workflows/` files
   - OR: Pull request that gets approved (unlikely)

2. **No Additional Access Required**
   - Cannot escalate beyond action's scope
   - Cannot access other secrets
   - Cannot modify repository code

### Blast Radius

**What can be affected:**
- Issue assignment behavior
- Workflow execution
- API rate limits (same repo only)

**What CANNOT be affected:**
- Repository code
- Other workflows' secrets
- Other repositories
- GitHub account security

---

## Defense in Depth

### Current Protections

✅ **GitHub Platform Level:**
- Workflow file approval required for PRs
- Secret masking in logs
- API rate limiting
- Permission boundaries

✅ **Action Level:**
- Minimal permissions (contents:read, issues:write)
- Concurrency controls
- Path traversal basic protection
- Error handling with defaults

### Recommended Additional Layers

1. Input validation (all user inputs)
2. Output sanitization (log content)
3. Resource limits (file size, array length)
4. Rate limit handling (retry logic)

---

## Exploitation Timeline

**Difficulty:** HARD  
**Typical Attack Path:**

1. **Gain Write Access** (HARD)
   - Compromise maintainer account
   - Social engineering
   - Insider threat

2. **Modify Workflow** (EASY once access gained)
   - Edit `.github/workflows/assign-copilot.yml`
   - Add malicious inputs

3. **Trigger Workflow** (EASY)
   - Close an issue
   - Manual dispatch
   - Wait for schedule

4. **Exploit Vulnerability** (LIMITED IMPACT)
   - Bypass wait times
   - Read template files
   - Cause minor disruptions

**Conclusion:** High barrier to entry, low reward for attacker

---

## Security Summary

### Risk Matrix

| Vulnerability | Severity | Exploitability | Impact | Risk Score |
|--------------|----------|----------------|--------|------------|
| V01 Integer Overflow | Medium | Low | Medium | **4/10** |
| V02 GraphQL Injection | Medium | Low | Low | **3/10** |
| V03 Path Traversal | Medium | Low | Medium | **4/10** |
| V04 Log Disclosure | Low | Low | Low | **2/10** |
| V05 Rate Limiting | Low | Medium | Low | **3/10** |
| V06 Label Arrays | Low | Low | Low | **2/10** |
| V07 Timing Attack | Low | Very Low | Very Low | **1/10** |

**Average Risk Score:** 2.7/10 ✅ LOW RISK

---

## Remediation Priority

### High Priority (Do First)
1. ✅ Add integer bounds validation
2. ✅ Add label name format validation

### Medium Priority (Do Soon)
3. ✅ Enhanced path validation (extensions, size limits)
4. ✅ Rate limiting protection

### Low Priority (Nice to Have)
5. Log sanitization improvements
6. Array size limits
7. Security documentation

---

## Testing Exploitation

All vulnerabilities have been tested and documented in:
- **`src/security.test.js`** - 28 test cases
- **All tests passing** - Vulnerabilities confirmed but controlled

Run tests:
```bash
npm test -- src/security.test.js
```

---

**Document Status:** Complete  
**Last Updated:** January 22, 2026  
**Classification:** Internal Security Assessment  
**Distribution:** Authorized Personnel Only
